<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ResIQ">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="description" content="ResIQ - Modern Property Management System for Vacation Rentals. Manage reservations, guest KYC, payments, invoicing, and property operations.">
    <title>ResIQ - Property Management System</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="/assets/logo-192.png">

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- jsPDF for Invoice Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style type="text/css">
        /* Critical inline styles for instant loading */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .loading-screen {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0ea5e9 0%, #14b8a6 100%);
            z-index: 99999;
        }
        .loading-content { text-align: center; color: white; }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
        <img src="assets/logo.png" alt="ResIQ" style="height: 80px; margin-bottom: 24px; filter: brightness(0) invert(1);">
        <div class="loading-spinner"></div>
        <p style="margin-top: 20px; font-size: 14px; opacity: 0.9;">Loading ResIQ...</p>
    </div>
</div>

<!-- ========================================
     LOGIN SCREEN - Modern Gradient Design
     ======================================== -->
<div id="loginScreen" class="login-screen hidden">
    <div class="login-card-modern">
        <div class="login-logo-modern">
            <img src="assets/logo.png" alt="ResIQ">
            <h1>ResIQ</h1>
            <p>Property Management System</p>
        </div>

        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group-modern">
                <label for="loginEmail">Email</label>
                <input
                    type="email"
                    id="loginEmail"
                    class="form-input-modern"
                    placeholder="admin@hostizzy.com"
                    autocomplete="email"
                    required
                >
            </div>

            <div class="form-group-modern">
                <label for="loginPassword">Password</label>
                <input
                    type="password"
                    id="loginPassword"
                    class="form-input-modern"
                    placeholder="Enter your password"
                    autocomplete="current-password"
                    required
                >
            </div>

            <button type="submit" class="btn-modern btn-modern-primary" style="width: 100%; margin-top: 8px;">
                <span>Sign In</span>
                <span>‚Üí</span>
            </button>
        </form>

        <p style="text-align: center; margin-top: 24px; font-size: 12px; color: var(--text-tertiary);">
            Secured by Hostizzy
        </p>
    </div>
</div>

<!-- ========================================
     MAIN APP CONTAINER
     ======================================== -->
<div id="mainApp" class="app-container-modern hidden">

    <!-- ========================================
         MODERN SIDEBAR NAVIGATION
         ======================================== -->
    <aside class="sidebar-modern" id="sidebar">
        <!-- Sidebar Header -->
        <div class="sidebar-modern-header">
            <div class="sidebar-modern-logo">
                <img src="assets/logo.png" alt="ResIQ">
                <div class="sidebar-modern-logo-text">
                    <h2>ResIQ</h2>
                    <p>Property Management</p>
                </div>
            </div>
        </div>

        <!-- Sidebar Navigation -->
        <nav class="sidebar-modern-nav">
            <!-- Main Section -->
            <div class="sidebar-modern-section">
                <div class="sidebar-modern-section-title">Main</div>
                <a class="sidebar-modern-item active" onclick="showView('dashboard')">
                    <span class="sidebar-modern-item-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('reservations')">
                    <span class="sidebar-modern-item-icon">üìÖ</span>
                    <span>Reservations</span>
                    <span class="sidebar-modern-item-badge" id="reservationsBadge">0</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('guests')">
                    <span class="sidebar-modern-item-icon">üë•</span>
                    <span>Guests</span>
                </a>
            </div>

            <!-- Financial Section -->
            <div class="sidebar-modern-section">
                <div class="sidebar-modern-section-title">Financial</div>
                <a class="sidebar-modern-item" onclick="showView('payments')">
                    <span class="sidebar-modern-item-icon">üí∞</span>
                    <span>Payments</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('invoices')">
                    <span class="sidebar-modern-item-icon">üßæ</span>
                    <span>Invoices</span>
                </a>
            </div>

            <!-- Operations Section -->
            <div class="sidebar-modern-section">
                <div class="sidebar-modern-section-title">Operations</div>
                <a class="sidebar-modern-item" onclick="showView('documents')">
                    <span class="sidebar-modern-item-icon">üìã</span>
                    <span>Documents (KYC)</span>
                    <span class="sidebar-modern-item-badge" id="documentsBadge">0</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('communications')">
                    <span class="sidebar-modern-item-icon">üì±</span>
                    <span>Communications</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('properties')">
                    <span class="sidebar-modern-item-icon">üè†</span>
                    <span>Properties</span>
                </a>
            </div>

            <!-- Settings Section -->
            <div class="sidebar-modern-section">
                <div class="sidebar-modern-section-title">Settings</div>
                <a class="sidebar-modern-item" onclick="showView('team')">
                    <span class="sidebar-modern-item-icon">üë®‚Äçüíº</span>
                    <span>Team</span>
                </a>
                <a class="sidebar-modern-item" onclick="showView('settings')">
                    <span class="sidebar-modern-item-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </a>
            </div>
        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-modern-footer">
            <div class="sidebar-modern-user" onclick="handleLogout()">
                <div class="sidebar-modern-user-avatar" id="userAvatar">U</div>
                <div class="sidebar-modern-user-info">
                    <h4 id="userName">User</h4>
                    <p id="userEmail">user@hostizzy.com</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- ========================================
         MAIN CONTENT AREA
         ======================================== -->
    <main class="main-content-modern">

        <!-- ========================================
             VIEW: DASHBOARD
             ======================================== -->
        <div id="dashboardView" class="view-container">
            <!-- Header -->
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Dashboard</h1>
                        <p>Overview of your property management</p>
                    </div>
                    <div class="main-header-actions">
                        <div class="search-bar-modern">
                            <span class="search-bar-modern-icon">üîç</span>
                            <input type="text" placeholder="Search reservations, guests..." id="globalSearch">
                        </div>
                        <button class="btn-modern btn-modern-primary" onclick="openNewReservationModal()">
                            <span>‚ûï</span>
                            <span>New Reservation</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Body -->
            <div class="main-body-modern">
                <!-- Stats Grid -->
                <div class="stats-grid-modern" id="dashboardStats">
                    <div class="stat-card-modern">
                        <div class="stat-card-modern-header">
                            <span class="stat-card-modern-title">Total Reservations</span>
                            <div class="stat-card-modern-icon" style="background: var(--primary-subtle);">üìÖ</div>
                        </div>
                        <div class="stat-card-modern-value" id="statTotalReservations">0</div>
                        <div class="stat-card-modern-footer">
                            <span class="stat-card-modern-trend up">‚Üë 12%</span>
                            <span style="color: var(--text-tertiary);">vs last month</span>
                        </div>
                    </div>

                    <div class="stat-card-modern">
                        <div class="stat-card-modern-header">
                            <span class="stat-card-modern-title">Revenue</span>
                            <div class="stat-card-modern-icon" style="background: var(--success-subtle);">üí∞</div>
                        </div>
                        <div class="stat-card-modern-value" id="statTotalRevenue">‚Çπ0</div>
                        <div class="stat-card-modern-footer">
                            <span class="stat-card-modern-trend up">‚Üë 8%</span>
                            <span style="color: var(--text-tertiary);">vs last month</span>
                        </div>
                    </div>

                    <div class="stat-card-modern">
                        <div class="stat-card-modern-header">
                            <span class="stat-card-modern-title">Pending Payments</span>
                            <div class="stat-card-modern-icon" style="background: var(--warning-subtle);">‚ö†Ô∏è</div>
                        </div>
                        <div class="stat-card-modern-value" id="statPendingPayments">‚Çπ0</div>
                        <div class="stat-card-modern-footer">
                            <span class="stat-card-modern-trend down">‚Üì 5%</span>
                            <span style="color: var(--text-tertiary);">vs last month</span>
                        </div>
                    </div>

                    <div class="stat-card-modern">
                        <div class="stat-card-modern-header">
                            <span class="stat-card-modern-title">Occupancy Rate</span>
                            <div class="stat-card-modern-icon" style="background: var(--info-subtle);">üìà</div>
                        </div>
                        <div class="stat-card-modern-value" id="statOccupancy">0%</div>
                        <div class="stat-card-modern-footer">
                            <span class="stat-card-modern-trend up">‚Üë 3%</span>
                            <span style="color: var(--text-tertiary);">vs last month</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--spacing-lg); margin-bottom: var(--spacing-lg);">
                    <div class="card-modern">
                        <div class="card-modern-header">
                            <h3>Revenue Trend</h3>
                            <p>Last 6 months performance</p>
                        </div>
                        <div class="card-modern-body">
                            <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>

                    <div class="card-modern">
                        <div class="card-modern-header">
                            <h3>Booking Sources</h3>
                            <p>Channel distribution</p>
                        </div>
                        <div class="card-modern-body">
                            <canvas id="sourcesChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Reservations -->
                <div class="card-modern">
                    <div class="card-modern-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>Recent Reservations</h3>
                            <p>Latest bookings and their status</p>
                        </div>
                        <button class="btn-modern btn-modern-ghost btn-modern-sm" onclick="showView('reservations')">
                            View All ‚Üí
                        </button>
                    </div>
                    <div class="card-modern-body" style="padding: 0;">
                        <div class="table-modern-container" style="border: none; box-shadow: none;">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>Guest</th>
                                        <th>Property</th>
                                        <th>Check-in</th>
                                        <th>Check-out</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="recentReservationsTable">
                                    <tr>
                                        <td colspan="8">
                                            <div class="empty-state-modern">
                                                <div class="empty-state-modern-icon">üìÖ</div>
                                                <h3>No reservations yet</h3>
                                                <p>Create your first reservation to get started</p>
                                                <button class="btn-modern btn-modern-primary" onclick="openNewReservationModal()">
                                                    Create Reservation
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             VIEW: RESERVATIONS
             ======================================== -->
        <div id="reservationsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Reservations</h1>
                        <p>Manage all your bookings</p>
                    </div>
                    <div class="main-header-actions">
                        <button class="btn-modern btn-modern-secondary btn-modern-sm">
                            <span>üì•</span>
                            <span>Export</span>
                        </button>
                        <button class="btn-modern btn-modern-primary" onclick="openNewReservationModal()">
                            <span>‚ûï</span>
                            <span>New Reservation</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="main-body-modern">
                <!-- Filters -->
                <div class="filters-bar-modern">
                    <span style="font-weight: 600; color: var(--text-secondary); font-size: var(--text-sm);">Filter:</span>
                    <div class="filter-chip-modern active" onclick="filterReservations('all')">All</div>
                    <div class="filter-chip-modern" onclick="filterReservations('confirmed')">Confirmed</div>
                    <div class="filter-chip-modern" onclick="filterReservations('checked-in')">Checked In</div>
                    <div class="filter-chip-modern" onclick="filterReservations('checked-out')">Checked Out</div>
                    <div class="filter-chip-modern" onclick="filterReservations('cancelled')">Cancelled</div>
                </div>

                <!-- Reservations Table/Grid -->
                <div class="table-modern-container">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Guest Name</th>
                                <th>Property</th>
                                <th>Check-in</th>
                                <th>Check-out</th>
                                <th>Guests</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reservationsTableBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========================================
             VIEW: INVOICES (NEW)
             ======================================== -->
        <div id="invoicesView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Invoices</h1>
                        <p>GST-compliant invoicing system</p>
                    </div>
                    <div class="main-header-actions">
                        <div class="search-bar-modern">
                            <span class="search-bar-modern-icon">üîç</span>
                            <input type="text" placeholder="Search invoices..." id="invoiceSearch">
                        </div>
                    </div>
                </div>
            </header>

            <div class="main-body-modern">
                <div class="table-modern-container">
                    <table class="table-modern">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Booking ID</th>
                                <th>Guest Name</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>GST</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTableBody">
                            <tr>
                                <td colspan="9">
                                    <div class="empty-state-modern">
                                        <div class="empty-state-modern-icon">üßæ</div>
                                        <h3>No invoices generated yet</h3>
                                        <p>Invoices will appear here once generated from reservations</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ========================================
             VIEW: COMMUNICATIONS HUB (NEW)
             ======================================== -->
        <div id="communicationsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Communications</h1>
                        <p>Unified messaging center</p>
                    </div>
                    <div class="main-header-actions">
                        <button class="btn-modern btn-modern-secondary btn-modern-sm">
                            <span>üìß</span>
                            <span>Email</span>
                        </button>
                        <button class="btn-modern btn-modern-secondary btn-modern-sm">
                            <span>üì±</span>
                            <span>WhatsApp</span>
                        </button>
                        <button class="btn-modern btn-modern-secondary btn-modern-sm">
                            <span>üí¨</span>
                            <span>SMS</span>
                        </button>
                    </div>
                </div>
            </header>

            <div class="main-body-modern">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: var(--spacing-lg); height: calc(100vh - 200px);">
                    <!-- Channel Stats -->
                    <div class="card-modern">
                        <div class="card-modern-header">
                            <h3>Communication Stats</h3>
                        </div>
                        <div class="card-modern-body">
                            <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                                <div style="padding: var(--spacing-md); background: var(--background-alt); border-radius: var(--radius-md);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 24px;">üì±</span>
                                            <span style="font-weight: 600;">WhatsApp</span>
                                        </span>
                                        <span style="font-size: var(--text-2xl); font-weight: 700; color: var(--primary);">0</span>
                                    </div>
                                </div>
                                <div style="padding: var(--spacing-md); background: var(--background-alt); border-radius: var(--radius-md);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 24px;">üìß</span>
                                            <span style="font-weight: 600;">Email</span>
                                        </span>
                                        <span style="font-size: var(--text-2xl); font-weight: 700; color: var(--secondary);">0</span>
                                    </div>
                                </div>
                                <div style="padding: var(--spacing-md); background: var(--background-alt); border-radius: var(--radius-md);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 24px;">üí¨</span>
                                            <span style="font-weight: 600;">SMS</span>
                                        </span>
                                        <span style="font-size: var(--text-2xl); font-weight: 700; color: var(--accent);">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communication History -->
                    <div class="card-modern">
                        <div class="card-modern-header">
                            <h3>Recent Communications</h3>
                            <p>All channels combined</p>
                        </div>
                        <div class="card-modern-body" style="max-height: 600px; overflow-y: auto;">
                            <div id="communicationsHistory">
                                <div class="empty-state-modern">
                                    <div class="empty-state-modern-icon">üì¨</div>
                                    <h3>No communications yet</h3>
                                    <p>Communication history will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional views (Guests, Payments, Documents, Properties, Team, Settings) would go here -->
        <!-- For brevity, I'll add placeholders for now -->

        <div id="guestsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Guests</h1>
                        <p>Manage guest profiles and history</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Guests view coming soon...</p>
            </div>
        </div>

        <div id="paymentsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Payments</h1>
                        <p>Track payments and transactions</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Payments view coming soon...</p>
            </div>
        </div>

        <div id="documentsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Guest Documents (KYC)</h1>
                        <p>Verify and approve guest documents</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Documents view coming soon...</p>
            </div>
        </div>

        <div id="propertiesView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Properties</h1>
                        <p>Manage your vacation rental properties</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Properties view coming soon...</p>
            </div>
        </div>

        <div id="teamView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Team</h1>
                        <p>Manage team members and roles</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Team view coming soon...</p>
            </div>
        </div>

        <div id="settingsView" class="view-container hidden">
            <header class="main-header-modern">
                <div class="main-header-content">
                    <div class="main-header-title">
                        <h1>Settings</h1>
                        <p>Configure your account and preferences</p>
                    </div>
                </div>
            </header>
            <div class="main-body-modern">
                <p>Settings view coming soon...</p>
            </div>
        </div>

    </main>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast-modern" style="position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: none;">
    <div id="toastContent"></div>
</div>

<!-- Load Modules via Vite -->
<script type="module" src="/src/main.js"></script>

<!-- Temporary inline scripts for demo (will be moved to modules) -->
<script>
// View Management
function showView(viewName) {
    // Hide all views
    document.querySelectorAll('.view-container').forEach(v => v.classList.add('hidden'));

    // Show selected view
    const viewId = viewName + 'View';
    const view = document.getElementById(viewId);
    if (view) {
        view.classList.remove('hidden');
    }

    // Update sidebar active state
    document.querySelectorAll('.sidebar-modern-item').forEach(item => {
        item.classList.remove('active');
    });
    event.target.closest('.sidebar-modern-item')?.classList.add('active');
}

// Initialize app
document.addEventListener('DOMContentLoaded', () => {
    // Hide loading screen
    setTimeout(() => {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('loginScreen').classList.remove('hidden');
    }, 1000);
});

// Login handler
function handleLogin(e) {
    e.preventDefault();
    // Show loading
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');

    // Set user info
    const email = document.getElementById('loginEmail').value;
    document.getElementById('userEmail').textContent = email;
    document.getElementById('userName').textContent = email.split('@')[0];
    document.getElementById('userAvatar').textContent = email[0].toUpperCase();
}

// Logout handler
function handleLogout() {
    if (confirm('Are you sure you want to logout?')) {
        document.getElementById('mainApp').classList.add('hidden');
        document.getElementById('loginScreen').classList.remove('hidden');
    }
}

// Placeholder functions
function openNewReservationModal() {
    alert('New Reservation Modal - Coming Soon!');
}

function filterReservations(status) {
    // Update active filter
    document.querySelectorAll('.filter-chip-modern').forEach(chip => {
        chip.classList.remove('active');
    });
    event.target.classList.add('active');

    console.log('Filter by:', status);
}
</script>

</body>
</html>
